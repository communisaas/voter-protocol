# Cloudflare Workers Configuration - Shadow Atlas
# Purpose: Municipal boundary discovery, selection, fetch, and Merkle tree construction

name = "voter-protocol-shadow-atlas"
main = "src/index.ts"
compatibility_date = "2025-11-01"

# Account (replace with your Cloudflare account ID)
# Get from: wrangler whoami
# account_id = "" # Removed - not needed for local dev

# Workers configuration
[observability]
enabled = true

# D1 Database binding (SQLite)
[[d1_databases]]
binding = "DB"
database_name = "shadow-atlas"
database_id = "b702700e-38d7-4cd3-90bf-91df793614eb"

# R2 Storage binding (object storage)
[[r2_buckets]]
binding = "R2"
bucket_name = "shadow-atlas-artifacts"

# Environment variables (secrets via wrangler secret put)
[vars]
CENSUS_API_KEY = "" # Optional: Census API key for higher rate limits
GEMINI_API_KEY = "" # Google Gemini API key (for LLM selection)

# Durable Objects (for long-running GeoJSON downloads)
[[durable_objects.bindings]]
name = "FETCH_DO"
class_name = "FetchDurableObject"
script_name = "voter-protocol-shadow-atlas"

# Cron triggers (scheduled jobs)
[[triggers.crons]]
# Daily discovery scan (2 AM UTC)
cron = "0 2 * * *"

[[triggers.crons]]
# Daily selection (4 AM UTC)
cron = "0 4 * * *"

[[triggers.crons]]
# Daily fetch (6 AM UTC)
cron = "0 6 * * *"

# Worker limits
[limits]
cpu_ms = 30000  # 30 seconds for crawler operations
